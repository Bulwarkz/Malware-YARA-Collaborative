/*
	Bulwarkz generates four different rule types based on static and dynamic behavior data:

	 - Sample File (initial sample)
	 - Dropped File (files downloaded or stored during dynamic analysis)
	 - Opcode Memory (instruction opcodes from memory dumps of processes captured during dynamic analysis)

	A rule may be a simple or super rule. Compared to simple rules super rules include artifacts present in multiple files / analyses and are generic.

	This rule file contains simple Sample File rules. Artifact include strings and PE data.

	Automated rule generation is not perfect and therefore we encourage you to modify and extend the rules provided!
*/

import "pe"

rule sampe_174fdc20478ebd625e225edb7093f4f3_exe_0 {
	meta:
		description = "Auto-generated simple rule for file"
		author = "Bulwarkz Yara Rule Generator 1.0.0"
		yaraversion = ">= 3.2.0"
		tag = "Bulwarkz"
		source = "BBC5E5310998BF9DA8021CAEEB8C4D078C2EC53F34AC18F908D0FAD3DCE0186B.exe"
		joesandboxid = "239557"
		detection = "malicious"
		ruletype = "sample"
		superrule = "no"
		falsepositiverate = "unknown"
		md5 = "174fdc20478ebd625e225edb7093f4f3"
		sha1 = "e8bbff62300859f1b076b6ae16031d422ab192c8"
		sha256 = "bbc5e5310998bf9da8021caeeb8c4d078c2ec53f34ac18f908d0fad3dce0186b"
		date = "17/03/2017"
	strings:
		// Relevance: 6.0 Appears at: c48
		$s0 = "\\\\.\\pipe\\%s%s%d" fullword nocase wide ascii
		// Relevance: 6.0 Appears at: c67
		$s1 = "cmd.exe /q /c \"%s\"" fullword nocase wide ascii
		// Relevance: 3.0 Appears at: bd9
		$s2 = "Service" fullword nocase wide ascii
		// Relevance: 3.0 Appears at: b3
		$s3 = "@.data" fullword nocase wide ascii
		// Relevance: 0.0 Appears at: 475
		$s4 = "D$$hx0@" fullword nocase wide ascii
		// Relevance: 0.0 Appears at: c2d
		$s5 = "xCmd_stderr" fullword nocase wide ascii
		// Relevance: 0.0 Appears at: a4
		$s6 = "`.rdata" fullword nocase wide ascii
		// Relevance: 0.0 Appears at: c38
		$s7 = "xCmd_stdin" fullword nocase wide ascii
		// Relevance: 0.0 Appears at: bd1
		$s8 = "xCmdSvc" fullword nocase wide ascii
		// Relevance: 0.0 Appears at: c54
		$s9 = "xCmd_stdout" fullword nocase wide ascii
		// Opcode sequence from the PE entrypoint
		$entrypointOpCode = { 55 8B ?? 6A ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? }
	condition:
		all of them
		// PE Section check
		and pe.sections[0].name contains ".text"
		and pe.sections[1].name contains ".rdata"
		and pe.sections[2].name contains ".data"
		// PE Image characteristic check
		and pe.characteristics & pe.LOCAL_SYMS_STRIPPED
		and pe.characteristics & pe.EXECUTABLE_IMAGE
		and pe.characteristics & pe.LINE_NUMS_STRIPPED
		and pe.characteristics & pe.RELOCS_STRIPPED
		// PE subsystem check
		and pe.subsystem & pe.SUBSYSTEM_WINDOWS_CUI
}
